<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ClínicaHub — v3.4 Completa</title>
  <style>
    :root {
      --bg:#0b1220; --card:#111827; --line:rgba(255,255,255,.12);
      --text:#e7eefc; --muted:#aab7d6; --pri:#0ea5e9; --bad:#ef4444; --ok:#22c55e;
      --warn:#f59e0b; --r:14px;
    }
    * { box-sizing: border-box; font-family: system-ui, sans-serif; }
    body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 50px; }
    .hidden { display: none !important; }
    
    /* Header e Nav */
    header { padding: 16px; border-bottom: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center; }
    nav { display: flex; gap: 8px; padding: 10px 16px; overflow-x: auto; background: rgba(0,0,0,0.2); }
    
    /* Cards e Inputs */
    main { padding: 16px; max-width: 900px; margin: 0 auto; }
    .card { background: var(--card); border: 1px solid var(--line); border-radius: var(--r); padding: 16px; margin-bottom: 16px; }
    input, select, button { 
      width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--line); 
      background: rgba(255,255,255,.05); color: #fff; margin-top: 5px;
    }
    button { cursor: pointer; font-weight: bold; border: none; }
    button.pri { background: var(--pri); }
    button.sec { background: var(--line); }
    
    /* Agenda */
    .grid-agenda { display: grid; grid-template-columns: 80px 1fr; border: 1px solid var(--line); }
    .hour-cell { padding: 10px; border-bottom: 1px solid var(--line); background: rgba(0,0,0,0.3); font-size: 12px; }
    .slot-cell { padding: 10px; border-bottom: 1px solid var(--line); min-height: 50px; cursor: pointer; }
    .slot-filled-cassems { background: rgba(34, 197, 94, 0.2); border-left: 4px solid var(--ok); }
    .slot-filled-particular { background: rgba(245, 158, 11, 0.2); border-left: 4px solid var(--warn); }

    /* Login */
    #loginPage { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 10000; }
  </style>
</head>
<body>

<div id="loginPage">
  <div class="card" style="width: 320px;">
    <h2 style="margin-top:0">ClínicaHub</h2>
    <input type="text" id="user" placeholder="Usuário">
    <input type="password" id="pass" placeholder="Senha">
    <button class="pri" onclick="checkLogin()" style="margin-top:15px">Entrar</button>
    <p id="loginMsg" style="color:var(--bad); font-size:12px;" class="hidden">Acesso negado.</p>
  </div>
</div>

<div id="app" class="hidden">
  <header>
    <div style="font-weight:bold; color:var(--pri)">CH v3.4</div>
    <button onclick="logout()" style="width:auto; padding:5px 10px; font-size:12px" class="sec">Sair</button>
  </header>

  <nav>
    <button onclick="showTab('diario')">Diário</button>
    <button onclick="showTab('pacientes')">Pacientes</button>
    <button onclick="showTab('agenda')">Agenda</button>
  </nav>

  <main id="content">
    <section id="tab-diario" class="tab-content">
      <div class="card">
        <h3>Registrar Atendimento</h3>
        <input type="date" id="dia-data">
        <select id="dia-paciente"></select>
        <select id="dia-status">
          <option value="Realizou">Realizou</option>
          <option value="Faltou">Faltou</option>
          <option value="Desmarcou">Desmarcou</option>
        </select>
        <button class="pri" onclick="addSessao()" style="margin-top:10px">Salvar Sessão</button>
      </div>
      <div id="lista-diaria"></div>
    </section>

    <section id="tab-pacientes" class="tab-content hidden">
      <div class="card">
        <h3>Novo Paciente</h3>
        <input type="text" id="p-nome" placeholder="Nome do Paciente">
        <input type="number" id="p-valor" placeholder="Valor da Sessão (Ex: 80)">
        <select id="p-tipo">
          <option value="Cassems">Cassems</option>
          <option value="Particular">Particular</option>
        </select>
        <button class="pri" onclick="addPaciente()" style="margin-top:10px">Cadastrar</button>
      </div>
      <div id="lista-pacientes"></div>
    </section>

    <section id="tab-agenda" class="tab-content hidden">
      <div class="card">
        <h3>Agenda Semanal (Seg-Sex)</h3>
        <div id="agenda-render"></div>
      </div>
    </section>
  </main>
</div>

<script>
  // Banco de dados em LocalStorage
  let db = JSON.parse(localStorage.getItem('hub_db') || '{"pats":[], "sess":[], "agenda":{}}');

  function save() { localStorage.setItem('hub_db', JSON.stringify(db)); }

  // Login Simples (como no original)
  function checkLogin() {
    if(document.getElementById('user').value === 'gabriel' && document.getElementById('pass').value === '1234') {
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      init();
    } else {
      document.getElementById('loginMsg').classList.remove('hidden');
    }
  }

  function logout() { location.reload(); }

  // Navegação
  function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
    document.getElementById('tab-' + tabName).classList.remove('hidden');
    render();
  }

  // Pacientes
  function addPaciente() {
    const nome = document.getElementById('p-nome').value;
    const valor = document.getElementById('p-valor').value;
    const tipo = document.getElementById('p-tipo').value;
    if(!nome) return alert('Digite o nome');
    db.pats.push({ id: Date.now(), nome, valor, tipo });
    save(); render();
    document.getElementById('p-nome').value = '';
  }

  // Sessões
  function addSessao() {
    const data = document.getElementById('dia-data').value;
    const patId = document.getElementById('dia-paciente').value;
    const status = document.getElementById('dia-status').value;
    if(!data || !patId) return alert('Preencha os dados');
    db.sess.push({ data, patId, status });
    save(); render();
  }

  // Renderização Geral
  function render() {
    // Lista de Pacientes no Select
    const select = document.getElementById('dia-paciente');
    select.innerHTML = db.pats.map(p => `<option value="${p.id}">${p.nome}</option>`).join('');

    // Lista de Cards de Pacientes
    document.getElementById('lista-pacientes').innerHTML = db.pats.map(p => `
      <div class="card" style="display:flex; justify-content:space-between">
        <span><b>${p.nome}</b> (${p.tipo})</span>
        <span>R$ ${p.valor}</span>
      </div>
    `).join('');

    // Lista de atendimentos do dia
    const hoje = document.getElementById('dia-data').value;
    const sessoesHoje = db.sess.filter(s => s.data === hoje);
    document.getElementById('lista-diaria').innerHTML = sessoesHoje.map(s => {
      const p = db.pats.find(x => x.id == s.patId);
      return `<div class="card">${p ? p.nome : 'Excluído'} - <b>${s.status}</b></div>`;
    }).join('');

    renderAgenda();
  }

  // Lógica da Agenda (O que faltava no original)
  function renderAgenda() {
    const horas = ["07:00","08:00","09:00","10:00","11:00","13:00","14:00","15:00","16:00","17:00","18:00"];
    let html = '<div class="grid-agenda">';
    horas.forEach(h => {
      html += `<div class="hour-cell">${h}</div>`;
      html += `<div class="slot-cell" onclick="setAgenda('${h}')" id="slot-${h.replace(':','')}">Clique para agendar</div>`;
    });
    html += '</div>';
    document.getElementById('agenda-render').innerHTML = html;
  }

  function setAgenda(hora) {
    const nome = prompt("Nome do paciente para às " + hora + "?");
    if(nome) {
      const el = document.getElementById('slot-' + hora.replace(':',''));
      el.innerText = nome;
      el.className = 'slot-cell slot-filled-particular';
    }
  }

  function init() {
    document.getElementById('dia-data').value = new Date().toISOString().split('T')[0];
    render();
  }

</script>
</body>
</html>
