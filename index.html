<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ClÃ­nicaHub â€” Sistema Completo</title>
  <style>
    :root {
      --bg: #0a0f1c;
      --card: #141b2b;
      --line: rgba(255, 255, 255, 0.12);
      --text: #e2eaff;
      --muted: #9aa9c7;
      --pri: #0ea5e9;
      --bad: #ef4444;
      --ok: #22c55e;
      --warn: #f59e0b;
      --info: #8b5cf6;
      --r: 14px;
    }

    .light-mode {
      --bg: #f0f4fa;
      --card: #ffffff;
      --line: rgba(0, 0, 0, 0.12);
      --text: #1e293b;
      --muted: #64748b;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      transition: .3s;
    }

    .hidden {
      display: none !important;
    }

    .muted {
      color: var(--muted);
      font-size: .92rem;
    }

    .pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      font-size: .85rem;
      margin-right: 6px;
      margin-top: 6px;
    }

    .pill.ok {
      border-color: rgba(34, 197, 94, .35);
      background: rgba(34, 197, 94, .12);
    }

    .pill.bad {
      border-color: rgba(239, 68, 68, .35);
      background: rgba(239, 68, 68, .12);
    }

    .pill.info {
      border-color: rgba(139, 92, 246, .35);
      background: rgba(139, 92, 246, .12);
    }

    .pill.warn {
      border-color: rgba(245, 158, 11, .35);
      background: rgba(245, 158, 11, .12);
    }

    .pill.pri {
      border-color: rgba(14, 165, 233, .35);
      background: rgba(14, 165, 233, .12);
    }

    button {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, .06);
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      transition: .2s;
      font-size: .95rem;
    }

    button:hover {
      background: rgba(255, 255, 255, .12);
    }

    button.primary {
      border-color: rgba(14, 165, 233, .5);
      background: rgba(14, 165, 233, .25);
    }

    button.primary:hover {
      background: rgba(14, 165, 233, .35);
    }

    button.danger {
      border-color: rgba(239, 68, 68, .5);
      background: rgba(239, 68, 68, .18);
    }

    button.danger:hover {
      background: rgba(239, 68, 68, .28);
    }

    button.small {
      padding: 8px 12px;
      font-size: .9rem;
    }

    input,
    select,
    textarea {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, .06);
      color: var(--text);
      outline: none;
      font-family: inherit;
      font-size: .95rem;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: rgba(14, 165, 233, .5);
      box-shadow: 0 0 0 2px rgba(14, 165, 233, .2);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    label {
      display: block;
      margin: 0 0 6px;
      color: var(--muted);
      font-size: .9rem;
    }

    hr {
      border: none;
      border-top: 1px solid var(--line);
      margin: 14px 0;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 16px 24px;
      border-bottom: 1px solid var(--line);
      flex-wrap: wrap;
      background: rgba(0, 0, 0, .2);
    }

    h1 {
      margin: 0;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    main {
      padding: 20px;
      display: grid;
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 18px;
    }

    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: end;
    }

    .row>* {
      flex: 1 1 200px;
    }

    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }

    @media(max-width:900px) {
      .grid2 {
        grid-template-columns: 1fr;
      }
    }

    .sum {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .sum .cardMini {
      flex: 1 1 250px;
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 14px;
      background: rgba(255, 255, 255, .03);
    }

    .tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .tab {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, .04);
      padding: 10px 16px;
    }

    .tab.active {
      border-color: rgba(14, 165, 233, .45);
      background: rgba(14, 165, 233, .18);
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
      max-height: 500px;
      overflow-y: auto;
    }

    .item {
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, .03);
      border-radius: 14px;
      padding: 15px;
      transition: .2s;
    }

    .item:hover {
      background: rgba(255, 255, 255, .08);
      border-color: var(--pri);
    }

    .item.clickable {
      cursor: pointer;
    }

    .itemTop {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .split {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 15px;
    }

    @media(max-width:1000px) {
      .split {
        grid-template-columns: 1fr;
      }
    }

    .backup-bar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      background: rgba(14, 165, 233, .1);
      border: 1px solid rgba(14, 165, 233, .3);
      border-radius: 40px;
      padding: 8px 15px;
      margin-right: 10px;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: rgba(255, 255, 255, .03);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      color: var(--pri);
      margin: 10px 0;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, .1);
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--pri);
      transition: width .3s;
    }

    .schedWrap {
      overflow: auto;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(255, 255, 255, .02);
      max-height: 600px;
    }

    table.sched {
      border-collapse: collapse;
      width: 100%;
      min-width: 900px;
    }

    .sched th,
    .sched td {
      border: 1px solid rgba(255, 255, 255, .10);
      padding: 12px;
      vertical-align: top;
    }

    .sched th {
      background: rgba(255, 255, 255, .04);
      position: sticky;
      top: 0;
      z-index: 2;
    }

    .sched td {
      min-width: 160px;
      cursor: pointer;
      transition: .2s;
    }

    .sched td:hover {
      background: rgba(255, 255, 255, .08);
    }

    .timeCell {
      position: sticky;
      left: 0;
      z-index: 1;
      background: rgba(255, 255, 255, .04);
      font-weight: 800;
    }

    .slotBox {
      border-radius: 10px;
      padding: 12px;
      height: 100%;
    }

    .slotGreen {
      background: rgba(34, 197, 94, .15);
      border-left: 4px solid #22c55e;
    }

    .slotAmber {
      background: rgba(245, 158, 11, .15);
      border-left: 4px solid #f59e0b;
    }

    .slotRed {
      background: rgba(239, 68, 68, .15);
      border-left: 4px solid #ef4444;
    }

    .slotBlue {
      background: rgba(14, 165, 233, .15);
      border-left: 4px solid #0ea5e9;
    }

    .slotPurple {
      background: rgba(139, 92, 246, .15);
      border-left: 4px solid #8b5cf6;
    }

    .iconAlert {
      font-size: 1.1rem;
      margin-right: 5px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, .7);
      backdrop-filter: blur(3px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 20px;
      padding: 25px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 12px;
      background: var(--card);
      border: 1px solid var(--pri);
      box-shadow: 0 4px 12px rgba(0, 0, 0, .3);
      z-index: 2000;
      animation: slideIn 0.3s;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: .8rem;
      font-weight: 600;
    }

    .badge-success {
      background: rgba(34, 197, 94, .2);
      color: #22c55e;
    }

    .badge-warning {
      background: rgba(245, 158, 11, .2);
      color: #f59e0b;
    }

    .badge-danger {
      background: rgba(239, 68, 68, .2);
      color: #ef4444;
    }

    .search-box {
      position: relative;
      margin-bottom: 15px;
    }

    .search-box input {
      padding-left: 40px;
    }

    .search-box::before {
      content: 'ğŸ”';
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      opacity: 0.5;
    }

    .folder-header {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--line);
    }

    .folder-actions {
      display: flex;
      gap: 8px;
      margin-left: auto;
      flex-wrap: wrap;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }

    .info-item {
      background: rgba(255, 255, 255, .03);
      border-radius: 10px;
      padding: 10px;
    }

    .info-label {
      font-size: .8rem;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .info-value {
      font-weight: 600;
    }

    .timeline {
      position: relative;
      padding-left: 20px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--pri);
    }

    .timeline-item {
      position: relative;
      padding: 10px 15px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, .03);
      border-radius: 8px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -26px;
      top: 15px;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--pri);
    }

    .shortcuts-hint {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 40px;
      padding: 10px 20px;
      font-size: .9rem;
      cursor: pointer;
      z-index: 100;
    }

    .shortcuts-panel {
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 20px;
      width: 300px;
      z-index: 100;
    }

    .shortcut-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--line);
    }

    .shortcut-key {
      background: rgba(255, 255, 255, .1);
      padding: 4px 8px;
      border-radius: 6px;
      font-family: monospace;
    }

    .meta-card {
      border-left: 4px solid;
      padding: 10px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, .03);
    }

    .meta-concluida {
      border-left-color: #22c55e;
    }

    .meta-andamento {
      border-left-color: #f59e0b;
    }

    .meta-cancelada {
      border-left-color: #ef4444;
    }
  </style>
</head>

<body>

  <section id="appWrap">
    <header>
      <div style="display:flex; align-items:center; gap:15px; flex-wrap:wrap;">
        <h1>ğŸ¥ ClÃ­nicaHub</h1>
        <div id="today" class="muted"></div>
        <button id="themeToggle" class="small" style="border-radius:30px;">ğŸŒ“ Tema</button>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <div class="backup-bar">
          <span class="muted">ğŸ’¾ Backup:</span>
          <button id="backupNow" class="small">â¬‡ï¸ Baixar</button>
          <button id="restoreBackup" class="small">ğŸ“‚ Restaurar</button>
          <button id="autoBackupToggle" class="small pri">ğŸ”µ Auto: ON</button>
        </div>

        <div class="tabs">
          <button class="tab active" id="tabDashboard">ğŸ“Š Dashboard</button>
          <button class="tab" id="tabDaily">ğŸ“… DiÃ¡rio</button>
          <button class="tab" id="tabPatients">ğŸ‘¥ Pacientes</button>
          <button class="tab" id="tabSchedule">ğŸ“† Agendamento</button>
          <button class="tab" id="tabReports">ğŸ“ˆ RelatÃ³rios</button>
        </div>
      </div>
    </header>

    <main>
      <!-- DASHBOARD -->
      <section id="viewDashboard" class="card">
        <h2>ğŸ“Š Dashboard</h2>
        <div class="dashboard-grid">
          <div class="stat-card">
            <div>Pacientes Hoje</div>
            <div class="stat-value" id="dashHoje">0</div>
            <div class="muted" id="dashHojeDetalhe"></div>
          </div>
          <div class="stat-card">
            <div>PrÃ³ximos 15min</div>
            <div class="stat-value" id="dashProximos">0</div>
            <div class="muted" id="dashProximosNomes"></div>
          </div>
          <div class="stat-card">
            <div>Faturamento Hoje</div>
            <div class="stat-value" id="dashFaturamento">R$ 0</div>
            <div class="muted" id="dashFaturamentoDetalhe"></div>
          </div>
          <div class="stat-card">
            <div>Taxa de Faltas</div>
            <div class="stat-value" id="dashTaxaFaltas">0%</div>
            <div class="progress-bar">
              <div class="progress-fill" id="dashProgresso" style="width:0%"></div>
            </div>
          </div>
        </div>

        <div style="margin-top:20px;">
          <h3>ğŸ‚ Aniversariantes do MÃªs</h3>
          <div id="aniversariantes" class="list"></div>
        </div>

        <div style="margin-top:20px;">
          <h3>â° PrÃ³ximos Atendimentos</h3>
          <div id="proximosAtendimentos" class="list"></div>
        </div>
      </section>

      <!-- DIÃRIO -->
      <section id="viewDaily" class="card hidden">
        <div class="row">
          <div>
            <label>Data do atendimento</label>
            <input id="date" type="date" />
          </div>
          <div>
            <label>Buscar paciente</label>
            <input id="search" placeholder="Nome..." />
          </div>
          <div style="display:flex; gap:8px;">
            <button id="findInDay" class="small primary">ğŸ” Procurar</button>
            <button id="clearDay" class="small danger">ğŸ—‘ï¸ Limpar dia</button>
          </div>
        </div>

        <div class="sum">
          <div class="cardMini">
            <b>Resumo do dia</b>
            <div class="muted" id="sumDay">â€”</div>
          </div>
          <div class="cardMini">
            <b>Financeiro</b>
            <div class="muted" id="sumMoney">â€”</div>
          </div>
          <div class="cardMini">
            <b>Faltas hoje</b>
            <div class="muted" id="sumAbsences">â€”</div>
          </div>
        </div>

        <hr>

        <b>â• Adicionar sessÃ£o</b>
        <div class="grid2">
          <div>
            <label>Paciente</label>
            <select id="pPatient"></select>
          </div>
          <div>
            <label>HorÃ¡rio</label>
            <input id="pTime" placeholder="14:30" />
          </div>
          <div>
            <label>SessÃ£o</label>
            <select id="pDid">
              <option value="realizou">âœ… Realizou</option>
              <option value="nao">âŒ NÃ£o realizou</option>
            </select>
          </div>
          <div>
            <label>Justificativa</label>
            <select id="pJust">
              <option value="na">â€”</option>
              <option value="justificada">ğŸ“ Justificada</option>
              <option value="nao_justificada">âš ï¸ NÃ£o justificada</option>
            </select>
          </div>
          <div>
            <label>Pagamento</label>
            <select id="pPaid">
              <option value="nao_pago">ğŸ’¸ NÃ£o pago</option>
              <option value="pago">ğŸ’° Pago</option>
            </select>
          </div>
          <div>
            <label>Valor (R$)</label>
            <input id="pValue" placeholder="80,00" />
            <small id="hintDefault" class="muted"></small>
          </div>
        </div>

        <div class="row">
          <button id="addSession" class="primary">â• Adicionar</button>
          <button id="resetAll" class="danger">âš ï¸ Zerar tudo</button>
        </div>

        <div class="list" id="dayList"></div>
      </section>

      <!-- PACIENTES -->
      <section id="viewPatients" class="card hidden">
        <div class="split">
          <!-- Cadastro -->
          <div class="card">
            <h3 style="margin-bottom:15px;">ğŸ‘¤ Cadastro de Paciente</h3>
            <div class="grid2">
              <div>
                <label>Nome completo *</label>
                <input id="cName" placeholder="JoÃ£o Silva" />
              </div>
              <div>
                <label>Data nascimento</label>
                <input id="cBirth" type="date" />
              </div>
              <div>
                <label>CPF</label>
                <input id="cCpf" placeholder="000.000.000-00" />
              </div>
              <div>
                <label>ResponsÃ¡vel</label>
                <input id="cResp" placeholder="Nome do responsÃ¡vel" />
              </div>
              <div>
                <label>WhatsApp</label>
                <input id="cPhone" placeholder="67999999999" />
                <small class="muted">Com DDD, sÃ³ nÃºmeros</small>
              </div>
              <div>
                <label>E-mail</label>
                <input id="cEmail" type="email" placeholder="paciente@email.com" />
              </div>
              <div>
                <label>ConvÃªnio</label>
                <select id="cServiceType">
                  <option value="particular">Particular</option>
                  <option value="cassems">Cassems</option>
                  <option value="unimed">Unimed</option>
                  <option value="outros">Outros</option>
                </select>
              </div>
              <div>
                <label>Valor padrÃ£o (R$)</label>
                <input id="cDefaultValue" placeholder="80,00" />
              </div>
              <div>
                <label>Tipo de cobranÃ§a</label>
                <select id="cBillingType">
                  <option value="pack4">ğŸ“¦ Pacote 4 sessÃµes</option>
                  <option value="pack8">ğŸ“¦ Pacote 8 sessÃµes</option>
                  <option value="individual">ğŸ’³ Individual</option>
                </select>
              </div>
              <div>
                <label>HorÃ¡rio fixo</label>
                <div style="display:flex; gap:8px;">
                  <select id="cFixDay" style="flex:1;">
                    <option value="">Dia</option>
                    <option value="0">Seg</option>
                    <option value="1">Ter</option>
                    <option value="2">Qua</option>
                    <option value="3">Qui</option>
                    <option value="4">Sex</option>
                    <option value="5">SÃ¡b</option>
                    <option value="6">Dom</option>
                  </select>
                  <input id="cFixHour" placeholder="07:40" style="flex:1;" />
                </div>
                <small class="muted">Agenda automaticamente</small>
              </div>
            </div>

            <label style="margin-top:15px;">ObservaÃ§Ãµes</label>
            <textarea id="cNotes" rows="3" placeholder="ObservaÃ§Ãµes importantes..."></textarea>

            <button id="addPatient" class="primary" style="margin-top:15px; width:100%;">ğŸ’¾ Salvar Paciente</button>
          </div>

          <!-- Lista de Pacientes -->
          <div class="card">
            <div id="foldersPane">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3>ğŸ“ Pacientes</h3>
                <div style="display:flex; gap:8px;">
                  <div class="search-box" style="width:200px;">
                    <input id="pSearch" placeholder="Buscar..." />
                  </div>
                  <button id="onlyDebtFolders" class="small">ğŸ’¸ Com dÃ©bito</button>
                </div>
              </div>
              <div id="patientFolders" class="list" style="max-height:600px;"></div>
            </div>

            <!-- PASTA DO PACIENTE -->
            <div id="folderOpenPane" class="hidden">
              <div class="folder-header">
                <button id="backToFolders" class="small">â† Voltar</button>
                <h3 id="openPatientTitle" style="margin:0;">Paciente</h3>
                <div class="folder-actions">
                  <button id="btnAnamnese" class="small info">ğŸ“‹ Anamnese</button>
                  <button id="btnEvolucao" class="small primary">ğŸ“ˆ EvoluÃ§Ã£o</button>
                  <button id="btnMetas" class="small warn">ğŸ¯ Metas</button>
                  <button id="openWhats" class="small">ğŸ“± WhatsApp</button>
                  <button id="editPatient" class="small">âœï¸ Editar</button>
                  <button id="deletePatient" class="small danger">ğŸ—‘ï¸ Excluir</button>
                </div>
              </div>

              <!-- InformaÃ§Ãµes do Paciente -->
              <div id="patientInfo" class="info-grid"></div>

              <!-- Progresso do Pacote -->
              <div id="pacoteProgresso" style="margin:15px 0; padding:15px; background:rgba(255,255,255,.03); border-radius:10px;"></div>

              <!-- Abas -->
              <div style="display:flex; gap:10px; margin:15px 0; border-bottom:1px solid var(--line); padding-bottom:10px; flex-wrap:wrap;">
                <button class="tab active" id="tabHistory">ğŸ“‹ HistÃ³rico</button>
                <button class="tab" id="tabEvolution">ğŸ“ˆ EvoluÃ§Ã£o</button>
                <button class="tab" id="tabGoals">ğŸ¯ Metas</button>
              </div>

              <!-- ConteÃºdo das Abas -->
              <div id="tabHistoryContent">
                <div style="margin-bottom:15px; display:flex; gap:10px; flex-wrap:wrap;">
                  <select id="historyYear" style="width:auto;"></select>
                  <select id="historyMonth" style="width:auto;"></select>
                  <button id="clearHistoryFilter" class="small">Limpar</button>
                </div>
                <div id="patientHistory" class="list"></div>
              </div>

              <div id="tabEvolutionContent" class="hidden">
                <button id="addEvolucao" class="primary small" style="margin-bottom:15px;">â• Nova EvoluÃ§Ã£o</button>
                <div id="evolutionList" class="timeline"></div>
              </div>

              <div id="tabGoalsContent" class="hidden">
                <button id="addMeta" class="primary small" style="margin-bottom:15px;">â• Nova Meta</button>
                <div id="goalsList" class="list"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- AGENDAMENTO -->
      <section id="viewSchedule" class="card hidden">
        <div class="row">
          <div>
            <label>Data referÃªncia</label>
            <input id="schedRef" type="date" />
          </div>
          <div>
            <label>Adicionar horÃ¡rio</label>
            <div style="display:flex; gap:8px;">
              <input id="newTime" placeholder="07:00" />
              <button id="addTime" class="small primary">â•</button>
            </div>
          </div>
          <div>
            <label>Filtro</label>
            <div style="display:flex; gap:5px;">
              <button id="filterHoje" class="small">Hoje</button>
              <button id="filterAmanha" class="small">AmanhÃ£</button>
              <button id="filterSemana" class="small">Semana</button>
            </div>
          </div>
        </div>

        <div class="schedWrap">
          <table class="sched" id="schedTable"></table>
        </div>

        <div class="muted" style="margin-top:15px; padding:10px; background:rgba(255,255,255,.03); border-radius:12px;">
          <span class="pill ok">ğŸŸ¢ Cassems</span>
          <span class="pill warn">ğŸŸ¡ Particular</span>
          <span class="pill info">ğŸŸ£ Unimed/Outros</span>
          <span class="pill bad">ğŸ”´ Vago</span>
        </div>
      </section>

      <!-- RELATÃ“RIOS -->
      <section id="viewReports" class="card hidden">
        <h2 style="margin-bottom:20px;">ğŸ“ˆ RelatÃ³rios</h2>

        <div class="grid2">
          <div class="cardMini">
            <b>Resumo do MÃªs</b>
            <div id="monthSummary" class="muted" style="margin-top:10px;">Carregando...</div>
          </div>
          <div class="cardMini">
            <b>Taxa de Faltas</b>
            <div id="absenceRate" class="muted" style="margin-top:10px;">Carregando...</div>
          </div>
          <div class="cardMini">
            <b>Faturamento</b>
            <div id="revenueStats" class="muted" style="margin-top:10px;">Carregando...</div>
          </div>
          <div class="cardMini">
            <b>Pacientes Ativos</b>
            <div id="activePatients" class="muted" style="margin-top:10px;">Carregando...</div>
          </div>
        </div>

        <div style="margin-top:20px;">
          <b>Pacientes com maior dÃ©bito</b>
          <div id="topDebtors" class="list" style="margin-top:10px;"></div>
        </div>
      </section>
    </main>

    <div class="shortcuts-hint" id="shortcutsHint">âŒ¨ï¸ Atalhos</div>
    <div class="shortcuts-panel hidden" id="shortcutsPanel">
      <h4 style="margin-bottom:10px;">Atalhos de Teclado</h4>
      <div class="shortcut-item"><span>Novo paciente</span> <span class="shortcut-key">Ctrl+N</span></div>
      <div class="shortcut-item"><span>Buscar</span> <span class="shortcut-key">Ctrl+F</span></div>
      <div class="shortcut-item"><span>Dashboard</span> <span class="shortcut-key">Ctrl+1</span></div>
      <div class="shortcut-item"><span>DiÃ¡rio</span> <span class="shortcut-key">Ctrl+2</span></div>
      <div class="shortcut-item"><span>Pacientes</span> <span class="shortcut-key">Ctrl+3</span></div>
      <div class="shortcut-item"><span>Agenda</span> <span class="shortcut-key">Ctrl+4</span></div>
      <div class="shortcut-item"><span>RelatÃ³rios</span> <span class="shortcut-key">Ctrl+5</span></div>
    </div>
  </section>

  <!-- MODAIS -->
  <div id="backupModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3>ğŸ’¾ Restaurar Backup</h3>
      <p class="muted">Selecione um arquivo de backup (.json)</p>
      <input type="file" id="backupFile" accept=".json" style="margin:15px 0;" />
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="cancelBackup" class="small">Cancelar</button>
        <button id="confirmRestore" class="danger small">Restaurar</button>
      </div>
    </div>
  </div>

  <div id="anamneseModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3>ğŸ“‹ Anamnese</h3>
      <div style="margin:15px 0;">
        <label>Queixa principal</label>
        <textarea id="aQueixa" rows="2"></textarea>
      </div>
      <div style="margin:15px 0;">
        <label>HistÃ³rico</label>
        <textarea id="aHistorico" rows="3"></textarea>
      </div>
      <div style="margin:15px 0;">
        <label>ObservaÃ§Ãµes</label>
        <textarea id="aObs" rows="3"></textarea>
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="closeAnamnese" class="small">Fechar</button>
        <button id="saveAnamnese" class="primary small">Salvar</button>
      </div>
    </div>
  </div>

  <div id="evolucaoModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3>ğŸ“ˆ Nova EvoluÃ§Ã£o</h3>
      <div style="margin:15px 0;">
        <label>Data</label>
        <input type="date" id="evoData" />
      </div>
      <div style="margin:15px 0;">
        <label>EvoluÃ§Ã£o</label>
        <textarea id="evoTexto" rows="4" placeholder="Descreva a evoluÃ§Ã£o do paciente..."></textarea>
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="cancelEvo" class="small">Cancelar</button>
        <button id="saveEvo" class="primary small">Salvar</button>
      </div>
    </div>
  </div>

  <div id="metaModal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3>ğŸ¯ Nova Meta</h3>
      <div style="margin:15px 0;">
        <label>DescriÃ§Ã£o</label>
        <input type="text" id="metaDesc" placeholder="Ex: Produzir som de /r/..." />
      </div>
      <div style="margin:15px 0;">
        <label>Prazo</label>
        <input type="date" id="metaPrazo" />
      </div>
      <div style="margin:15px 0;">
        <label>Status</label>
        <select id="metaStatus">
          <option value="em_andamento">â³ Em andamento</option>
          <option value="concluida">âœ… ConcluÃ­da</option>
          <option value="cancelada">âŒ Cancelada</option>
        </select>
      </div>
      <div style="display:flex; gap:10px; justify-content:flex-end;">
        <button id="cancelMeta" class="small">Cancelar</button>
        <button id="saveMeta" class="primary small">Salvar</button>
      </div>
    </div>
  </div>

  <script>
    // ========== CONFIGURAÃ‡Ã•ES ==========
    const KEYS = {
      PATIENTS: "clinica_pro_patients",
      SESSIONS: "clinica_pro_sessions",
      SCHEDULE: "clinica_pro_schedule",
      EVOLUTIONS: "clinica_pro_evolutions",
      GOALS: "clinica_pro_goals",
      BACKUP: "clinica_pro_backup",
      THEME: "clinica_pro_theme"
    };

    const DAYS = ["Seg", "Ter", "Qua", "Qui", "Sex", "SÃ¡b", "Dom"];
    const SERVICE_COLORS = {
      "cassems": "slotGreen",
      "particular": "slotAmber",
      "unimed": "slotPurple",
      "outros": "slotBlue"
    };

    let autoBackup = localStorage.getItem("autoBackup") !== "false";
    let openedPatientId = null;
    let alertTimeout = null;
    let historyFilters = { year: "all", month: "all" };

    const $ = id => document.getElementById(id);

    // ========== UTILITÃRIOS ==========
    function uid() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function todayISO() {
      const d = new Date();
      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
    }

    function nowTime() {
      const d = new Date();
      return `${String(d.getHours()).padStart(2, "0")}:${String(d.getMinutes()).padStart(2, "0")}`;
    }

    function parseMoney(val) {
      if (!val) return 0;
      return Number(String(val).replace(/\./g, "").replace(",", ".")) || 0;
    }

    function fmtMoney(val) {
      return Number(val || 0).toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    }

    function escapeHtml(str) {
      return String(str || "")
        .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    function saveData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
      if (autoBackup && key !== KEYS.BACKUP) {
        createAutoBackup();
      }
    }

    function loadData(key, defaultValue = null) {
      try {
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : defaultValue;
      } catch {
        return defaultValue;
      }
    }

    function showAlert(message, type = "info") {
      if (alertTimeout) clearTimeout(alertTimeout);
      
      const alert = document.createElement("div");
      alert.className = `alert`;
      alert.innerHTML = message;
      alert.style.background = type === "success" ? "rgba(34,197,94,.2)" : 
                              type === "warning" ? "rgba(245,158,11,.2)" : 
                              "rgba(14,165,233,.2)";
      alert.style.borderColor = type === "success" ? "#22c55e" : 
                                type === "warning" ? "#f59e0b" : 
                                "#0ea5e9";
      document.body.appendChild(alert);
      
      alertTimeout = setTimeout(() => alert.remove(), 3000);
    }

    // ========== TEMA ==========
    function toggleTheme() {
      document.body.classList.toggle("light-mode");
      const isLight = document.body.classList.contains("light-mode");
      localStorage.setItem(KEYS.THEME, isLight ? "light" : "dark");
      $("themeToggle").innerHTML = isLight ? "ğŸŒ™ Tema" : "â˜€ï¸ Tema";
    }

    if (localStorage.getItem(KEYS.THEME) === "light") {
      document.body.classList.add("light-mode");
      $("themeToggle").innerHTML = "ğŸŒ™ Tema";
    }

    // ========== BACKUP ==========
    function createBackup() {
      return {
        version: "1.0",
        date: new Date().toISOString(),
        data: {
          patients: loadData(KEYS.PATIENTS, []),
          sessions: loadData(KEYS.SESSIONS, []),
          schedule: loadData(KEYS.SCHEDULE, { times: defaultTimes(), recurring: {} }),
          evolutions: loadData(KEYS.EVOLUTIONS, {}),
          goals: loadData(KEYS.GOALS, {})
        }
      };
    }

    function downloadBackup() {
      const backup = createBackup();
      const blob = new Blob([JSON.stringify(backup, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `clinica_backup_${todayISO()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showAlert("âœ… Backup baixado!", "success");
    }

    function restoreFromFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const backup = JSON.parse(e.target.result);
          if (backup.version && backup.data) {
            saveData(KEYS.PATIENTS, backup.data.patients || []);
            saveData(KEYS.SESSIONS, backup.data.sessions || []);
            saveData(KEYS.SCHEDULE, backup.data.schedule || { times: defaultTimes(), recurring: {} });
            saveData(KEYS.EVOLUTIONS, backup.data.evolutions || {});
            saveData(KEYS.GOALS, backup.data.goals || {});

            showAlert("âœ… Backup restaurado!", "success");
            setTimeout(() => location.reload(), 1500);
          } else {
            showAlert("âŒ Arquivo invÃ¡lido", "error");
          }
        } catch (err) {
          showAlert("âŒ Erro ao ler arquivo", "error");
        }
      };
      reader.readAsText(file);
    }

    function createAutoBackup() {
      const backups = loadData(KEYS.BACKUP, []);
      const newBackup = createBackup();
      backups.unshift(newBackup);
      if (backups.length > 10) backups.pop();
      saveData(KEYS.BACKUP, backups);
    }

    // ========== PACIENTES ==========
    function loadPatients() { return loadData(KEYS.PATIENTS, []); }
    function savePatients(p) { saveData(KEYS.PATIENTS, p); }

    function getPatientById(id) {
      return loadPatients().find(p => p.id === id);
    }

    // ========== SESSÃ•ES ==========
    function loadSessions() { return loadData(KEYS.SESSIONS, []); }
    function saveSessions(s) { saveData(KEYS.SESSIONS, s); }

    // ========== EVOLUÃ‡Ã•ES ==========
    function loadEvolutions(patientId) {
      const all = loadData(KEYS.EVOLUTIONS, {});
      return all[patientId] || [];
    }

    function saveEvolution(patientId, evolutions) {
      const all = loadData(KEYS.EVOLUTIONS, {});
      all[patientId] = evolutions;
      saveData(KEYS.EVOLUTIONS, all);
    }

    // ========== METAS ==========
    function loadGoals(patientId) {
      const all = loadData(KEYS.GOALS, {});
      return all[patientId] || [];
    }

    function saveGoals(patientId, goals) {
      const all = loadData(KEYS.GOALS, {});
      all[patientId] = goals;
      saveData(KEYS.GOALS, all);
    }

    // ========== AGENDA ==========
    function loadSchedule() {
      return loadData(KEYS.SCHEDULE, { times: defaultTimes(), recurring: {} });
    }
    function saveSchedule(s) { saveData(KEYS.SCHEDULE, s); }

    function defaultTimes() {
      return ["07:00", "07:40", "08:20", "09:00", "09:40", "10:20", "11:00", "13:20", "14:00", "14:40", "15:20", "16:00", "16:40", "17:20"];
    }

    function recurKey(day, time) { return `${day}|${time}`; }

    // ========== DASHBOARD ==========
    function renderDashboard() {
      const hoje = todayISO();
      const agora = nowTime();
      const sessions = loadSessions();
      const patients = loadPatients();
      
      const hojeSessions = sessions.filter(s => s.date === hoje);
      $("dashHoje").textContent = hojeSessions.length;
      
      const realizadasHoje = hojeSessions.filter(s => s.did === "realizou").length;
      const faltasHoje = hojeSessions.filter(s => s.did === "nao").length;
      $("dashHojeDetalhe").innerHTML = `âœ… ${realizadasHoje} â€¢ âŒ ${faltasHoje}`;
      
      const proximos = [];
      const schedule = loadSchedule();
      
      Object.entries(schedule.recurring || {}).forEach(([key, entry]) => {
        const [day, time] = key.split("|");
        if (parseInt(day) === (new Date().getDay() + 6) % 7) {
          const [h1, m1] = time.split(":").map(Number);
          const [h2, m2] = agora.split(":").map(Number);
          const diffMinutes = (h1 * 60 + m1) - (h2 * 60 + m2);
          
          if (diffMinutes > 0 && diffMinutes <= 15) {
            const patient = getPatientById(entry.patientId);
            proximos.push({ name: patient?.name || "?", time });
          }
        }
      });
      
      $("dashProximos").textContent = proximos.length;
      $("dashProximosNomes").innerHTML = proximos.map(p => `${p.time} ${p.name}`).join("<br>") || "â€”";
      
      const faturamentoHoje = hojeSessions
        .filter(s => s.did === "realizou" && s.paid === "pago")
        .reduce((sum, s) => sum + (Number(s.value) || 0), 0);
      const aReceberHoje = hojeSessions
        .filter(s => s.did === "realizou" && s.paid !== "pago")
        .reduce((sum, s) => sum + (Number(s.value) || 0), 0);
      
      $("dashFaturamento").textContent = fmtMoney(faturamentoHoje);
      $("dashFaturamentoDetalhe").innerHTML = `ğŸ’° ${fmtMoney(faturamentoHoje)}<br>ğŸ’¸ ${fmtMoney(aReceberHoje)}`;
      
      const currentMonth = hoje.slice(0, 7);
      const monthSessions = sessions.filter(s => s.date.startsWith(currentMonth));
      const monthFaltas = monthSessions.filter(s => s.did === "nao").length;
      const taxa = monthSessions.length ? (monthFaltas / monthSessions.length * 100).toFixed(1) : 0;
      $("dashTaxaFaltas").textContent = `${taxa}%`;
      $("dashProgresso").style.width = `${taxa}%`;
      
      const currentMonthNum = new Date().getMonth() + 1;
      const aniversariantes = patients.filter(p => {
        if (!p.birth) return false;
        const month = parseInt(p.birth.split("-")[1]);
        return month === currentMonthNum;
      });
      
      $("aniversariantes").innerHTML = aniversariantes.length ? 
        aniversariantes.map(p => `
          <div class="item">
            <b>ğŸ‚ ${escapeHtml(p.name)}</b>
            <div class="muted">${new Date(p.birth).toLocaleDateString("pt-BR")}</div>
            <button class="small" onclick="sendBirthdayMessage('${p.id}')">ğŸ“± WhatsApp</button>
          </div>
        `).join("") : 
        "<div class='muted'>Nenhum aniversariante</div>";
    }

    window.sendBirthdayMessage = (patientId) => {
      const p = getPatientById(patientId);
      if (p?.phone) {
        const msg = encodeURIComponent(`ğŸ‚ Feliz aniversÃ¡rio!`);
        window.open(`https://wa.me/55${p.phone}?text=${msg}`, "_blank");
      }
    };

    // ========== AGENDAMENTO ==========
    function renderSchedule() {
      const sch = loadSchedule();
      const patients = loadPatients();
      const times = (sch.times || []).sort();

      let html = "<thead><tr><th class='timeCell'>HorÃ¡rio</th>";
      DAYS.forEach(day => html += `<th>${day}</th>`);
      html += "</tr></thead><tbody>";

      for (const time of times) {
        html += `<tr><td class="timeCell">${escapeHtml(time)}</td>`;

        for (let day = 0; day < 7; day++) {
          const key = recurKey(day, time);
          const entry = sch.recurring?.[key];

          if (entry) {
            const patient = getPatientById(entry.patientId);
            const colorClass = SERVICE_COLORS[entry.serviceType] || "slotAmber";
            const serviceLabel = entry.serviceType === "cassems" ? "Cassems" :
                                entry.serviceType === "unimed" ? "Unimed" : "Particular";

            html += `<td data-day="${day}" data-time="${time}" class="slotBox ${colorClass}">
              <div style="font-weight:600;">${escapeHtml(patient?.name || "?")}</div>
              <div class="muted">${serviceLabel}</div>
            </td>`;
          } else {
            html += `<td data-day="${day}" data-time="${time}" class="slotBox slotRed" style="cursor:pointer;">
              <div>ğŸŸ¥ Vago</div>
              <div class="muted">Clique para agendar</div>
            </td>`;
          }
        }
        html += "</tr>";
      }

      $("schedTable").innerHTML = html;

      // Adicionar eventos de clique
      document.querySelectorAll("td[data-day]").forEach(td => {
        td.addEventListener("click", () => {
          const day = parseInt(td.dataset.day);
          const time = td.dataset.time;
          agendarHorario(day, time);
        });
      });
    }

    function agendarHorario(day, time) {
      const patients = loadPatients();
      if (patients.length === 0) {
        showAlert("âŒ Cadastre um paciente primeiro", "error");
        return;
      }

      const patientList = patients.map((p, i) => `${i+1} - ${p.name}`).join("\n");
      const choice = prompt(
        `Agendar para ${DAYS[day]} Ã s ${time}\n\n` +
        `Digite o nÃºmero do paciente:\n${patientList}\n\n` +
        `0 - Cancelar`
      );

      if (!choice || choice === "0") return;

      const idx = parseInt(choice) - 1;
      if (idx >= 0 && idx < patients.length) {
        const patient = patients[idx];
        
        const serviceType = prompt(
          `Tipo de atendimento para ${patient.name}:\n` +
          `1 - Particular\n2 - Cassems\n3 - Unimed\n4 - Outros`,
          "1"
        );

        let finalService = "particular";
        if (serviceType === "2") finalService = "cassems";
        else if (serviceType === "3") finalService = "unimed";
        else if (serviceType === "4") finalService = "outros";

        const sch = loadSchedule();
        sch.recurring = sch.recurring || {};
        sch.recurring[recurKey(day, time)] = {
          patientId: patient.id,
          serviceType: finalService,
          startDate: todayISO(),
          plannedTotal: 1
        };

        if (!sch.times.includes(time)) {
          sch.times.push(time);
          sch.times.sort();
        }

        saveSchedule(sch);
        renderSchedule();
        showAlert(`âœ… ${patient.name} agendado!`, "success");
      }
    }

    // ========== RELATÃ“RIOS ==========
    function generateReports() {
      const sessions = loadSessions();
      const patients = loadPatients();
      const currentMonth = todayISO().slice(0, 7);

      const monthSessions = sessions.filter(s => s.date.startsWith(currentMonth));
      const realizacoes = monthSessions.filter(s => s.did === "realizou");
      const faltas = monthSessions.filter(s => s.did === "nao");
      const faturamento = realizacoes.reduce((sum, s) => sum + (Number(s.value) || 0), 0);
      const aReceber = monthSessions.filter(s => s.paid !== "pago").reduce((sum, s) => sum + (Number(s.value) || 0), 0);

      $("monthSummary").innerHTML = `SessÃµes: ${monthSessions.length}<br>âœ… ${realizacoes.length}<br>âŒ ${faltas.length}`;
      $("absenceRate").innerHTML = monthSessions.length ? `${((faltas.length / monthSessions.length) * 100).toFixed(1)}%` : "0%";
      $("revenueStats").innerHTML = `ğŸ’° ${fmtMoney(faturamento)}<br>ğŸ’¸ ${fmtMoney(aReceber)}`;
      $("activePatients").innerHTML = patients.length;

      const debtors = patients.map(p => {
        const patientSessions = sessions.filter(s => s.patientId === p.id && s.paid !== "pago");
        const debt = patientSessions.reduce((sum, s) => sum + (Number(s.value) || 0), 0);
        return { name: p.name, debt };
      }).filter(d => d.debt > 0).sort((a, b) => b.debt - a.debt).slice(0, 5);

      $("topDebtors").innerHTML = debtors.length ? debtors.map(d => `
        <div class="item">
          <b>${escapeHtml(d.name)}</b>
          <div class="muted">${fmtMoney(d.debt)}</div>
        </div>
      `).join("") : "<div class='muted'>Nenhum</div>";
    }

    // ========== DIÃRIO ==========
    function renderPatientSelect() {
      const pats = loadPatients();
      const sel = $("pPatient");
      sel.innerHTML = pats.length ?
        pats.map(p => `<option value="${p.id}">${escapeHtml(p.name)}</option>`).join("") :
        `<option value="">(Nenhum paciente)</option>`;
    }

    function renderDaily() {
      const date = $("date").value;
      const search = $("search").value.toLowerCase();
      const sessions = loadSessions().filter(s => s.date === date);

      const filtered = sessions.filter(s => {
        const p = getPatientById(s.patientId);
        return !search || (p?.name || "").toLowerCase().includes(search);
      });

      $("dayList").innerHTML = filtered.map(s => {
        const p = getPatientById(s.patientId);
        return `
        <div class="item">
          <div style="display:flex; justify-content:space-between;">
            <div>
              <b>${s.time || "â€”"} - ${escapeHtml(p?.name || "?")}</b>
              <div class="muted">
                ${s.did === "realizou" ? "âœ…" : "âŒ"} 
                ${s.paid === "pago" ? "ğŸ’°" : "ğŸ’¸"} 
                ${fmtMoney(s.value)}
              </div>
            </div>
          </div>
          <div class="actions">
            <button class="small" onclick="toggleSessionDid('${s.id}')">ğŸ”„</button>
            <button class="small" onclick="toggleSessionPaid('${s.id}')">ğŸ’°</button>
            <button class="small danger" onclick="deleteSession('${s.id}')">ğŸ—‘ï¸</button>
          </div>
        </div>
      `;
      }).join("") || "<div class='muted'>Nenhuma sessÃ£o</div>";

      $("sumDay").innerHTML = `Total: ${filtered.length}`;
      $("sumMoney").innerHTML = fmtMoney(filtered.reduce((s, r) => s + (Number(r.value) || 0), 0));
      $("sumAbsences").innerHTML = filtered.filter(s => s.did === "nao").length.toString();
    }

    window.toggleSessionDid = (id) => {
      const sessions = loadSessions();
      const idx = sessions.findIndex(s => s.id === id);
      if (idx >= 0) {
        sessions[idx].did = sessions[idx].did === "realizou" ? "nao" : "realizou";
        saveSessions(sessions);
        renderDaily();
        showAlert("âœ… SessÃ£o atualizada", "success");
      }
    };

    window.toggleSessionPaid = (id) => {
      const sessions = loadSessions();
      const idx = sessions.findIndex(s => s.id === id);
      if (idx >= 0) {
        sessions[idx].paid = sessions[idx].paid === "pago" ? "nao_pago" : "pago";
        saveSessions(sessions);
        renderDaily();
        showAlert("ğŸ’° Pagamento atualizado", "success");
      }
    };

    window.deleteSession = (id) => {
      if (confirm("Excluir esta sessÃ£o?")) {
        const sessions = loadSessions().filter(s => s.id !== id);
        saveSessions(sessions);
        renderDaily();
        showAlert("ğŸ—‘ï¸ SessÃ£o excluÃ­da", "success");
      }
    };

    // ========== PASTAS DE PACIENTES ==========
    function renderPatientFolders() {
      const search = $("pSearch").value.toLowerCase();
      let pats = loadPatients().filter(p => !search || p.name.toLowerCase().includes(search));

      if (window.debtFilterActive) {
        const sessions = loadSessions();
        pats = pats.filter(p => {
          const patientSessions = sessions.filter(s => s.patientId === p.id && s.paid !== "pago");
          return patientSessions.length > 0;
        });
      }

      const container = $("patientFolders");
      container.innerHTML = pats.map(p => {
        const sessions = loadSessions().filter(s => s.patientId === p.id);
        const debt = sessions.filter(s => s.paid !== "pago").reduce((sum, s) => sum + (Number(s.value) || 0), 0);

        return `
        <div class="item clickable" onclick="openPatientFolder('${p.id}')">
          <div style="display:flex; justify-content:space-between;">
            <div>
              <b>ğŸ“ ${escapeHtml(p.name)}</b>
              <div class="muted">
                ${p.serviceType || "Particular"} â€¢ ${sessions.length} sessÃµes
              </div>
            </div>
            ${debt > 0 ? `<span class="pill bad">ğŸ’° ${fmtMoney(debt)}</span>` : ''}
          </div>
        </div>
      `;
      }).join("") || "<div class='muted'>Nenhum paciente</div>";
    }

    function openPatientFolder(id) {
      openedPatientId = id;
      const p = getPatientById(id);
      
      $("foldersPane").classList.add("hidden");
      $("folderOpenPane").classList.remove("hidden");
      $("openPatientTitle").textContent = `ğŸ“ ${p?.name || "Paciente"}`;

      // InformaÃ§Ãµes do paciente
      const sessions = loadSessions().filter(s => s.patientId === id);
      const totalSessoes = sessions.length;
      const realizadas = sessions.filter(s => s.did === "realizou").length;
      const faltas = sessions.filter(s => s.did === "nao").length;
      const debt = sessions.filter(s => s.paid !== "pago").reduce((sum, s) => sum + (Number(s.value) || 0), 0);
      
      $("patientInfo").innerHTML = `
        <div class="info-item"><span class="info-label">ConvÃªnio</span><span class="info-value">${p?.serviceType || "Particular"}</span></div>
        <div class="info-item"><span class="info-label">Telefone</span><span class="info-value">${p?.phone || "â€”"}</span></div>
        <div class="info-item"><span class="info-label">E-mail</span><span class="info-value">${p?.email || "â€”"}</span></div>
        <div class="info-item"><span class="info-label">Total sessÃµes</span><span class="info-value">${totalSessoes}</span></div>
        <div class="info-item"><span class="info-label">Realizadas</span><span class="info-value" style="color:#22c55e;">${realizadas}</span></div>
        <div class="info-item"><span class="info-label">Faltas</span><span class="info-value" style="color:#ef4444;">${faltas}</span></div>
        <div class="info-item"><span class="info-label">DÃ©bito</span><span class="info-value" style="color:#ef4444;">${fmtMoney(debt)}</span></div>
      `;

      // Progresso do pacote
      const schedule = loadSchedule();
      let pacoteInfo = "Sem pacote ativo";
      
      Object.entries(schedule.recurring || {}).forEach(([key, entry]) => {
        if (entry.patientId === id && entry.plannedTotal > 1) {
          const sessionsCount = sessions.filter(s => s.did === "realizou" && s.date >= entry.startDate).length;
          const remaining = entry.plannedTotal - sessionsCount;
          const percent = (sessionsCount / entry.plannedTotal) * 100;
          
          pacoteInfo = `
            <b>ğŸ“¦ Pacote ${entry.plannedTotal} sessÃµes</b>
            <div class="progress-bar"><div class="progress-fill" style="width:${percent}%"></div></div>
            <div style="display:flex; justify-content:space-between;">
              <span>âœ… ${sessionsCount} realizadas</span>
              <span>â³ ${remaining} restantes</span>
            </div>
          `;
        }
      });
      $("pacoteProgresso").innerHTML = pacoteInfo;

      // Filtros de ano/mÃªs
      const years = [...new Set(sessions.map(s => s.date.slice(0,4)))].sort().reverse();
      const yearSelect = $("historyYear");
      yearSelect.innerHTML = '<option value="all">Todos os anos</option>' + 
        years.map(y => `<option value="${y}">${y}</option>`).join('');
      
      const monthSelect = $("historyMonth");
      monthSelect.innerHTML = '<option value="all">Todos os meses</option>' + 
        ["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"].map((m,i) => 
          `<option value="${String(i+1).padStart(2,'0')}">${m}</option>`).join('');

      // Renderizar todas as abas
      renderPatientHistory();
      renderEvolucoes();
      renderMetas();
    }

    function renderPatientHistory() {
      if (!openedPatientId) return;
      
      let sessions = loadSessions().filter(s => s.patientId === openedPatientId);
      
      if (historyFilters.year !== "all") {
        sessions = sessions.filter(s => s.date.startsWith(historyFilters.year));
      }
      if (historyFilters.month !== "all") {
        sessions = sessions.filter(s => s.date.slice(5,7) === historyFilters.month);
      }
      
      sessions.sort((a, b) => b.date.localeCompare(a.date));
      
      $("patientHistory").innerHTML = sessions.map(s => `
        <div class="item">
          <div style="display:flex; justify-content:space-between;">
            <div>
              <b>${s.date} ${s.time ? "Ã s " + s.time : ""}</b>
              <div class="muted">
                ${s.did === "realizou" ? "âœ… Realizou" : "âŒ NÃ£o realizou"} â€¢ 
                ${s.paid === "pago" ? "ğŸ’° Pago" : "ğŸ’¸ NÃ£o pago"} â€¢ 
                ${fmtMoney(s.value)}
              </div>
            </div>
          </div>
        </div>
      `).join("") || "<div class='muted'>Nenhuma sessÃ£o</div>";
    }

    // ========== EVOLUÃ‡Ã•ES ==========
    function renderEvolucoes() {
      if (!openedPatientId) return;
      
      const evolutions = loadEvolutions(openedPatientId);
      evolutions.sort((a, b) => b.date.localeCompare(a.date));
      
      $("evolutionList").innerHTML = evolutions.map(e => `
        <div class="timeline-item">
          <div style="font-weight:600;">${e.date}</div>
          <div class="muted" style="margin-top:5px;">${escapeHtml(e.text)}</div>
          <div style="margin-top:10px;">
            <button class="small danger" onclick="deleteEvolucao('${e.id}')">ğŸ—‘ï¸</button>
          </div>
        </div>
      `).join("") || "<div class='muted'>Nenhuma evoluÃ§Ã£o registrada</div>";
    }

    window.deleteEvolucao = (id) => {
      if (!openedPatientId) return;
      const evolutions = loadEvolutions(openedPatientId).filter(e => e.id !== id);
      saveEvolution(openedPatientId, evolutions);
      renderEvolucoes();
      showAlert("âœ… EvoluÃ§Ã£o removida", "success");
    };

    // ========== METAS ==========
    function renderMetas() {
      if (!openedPatientId) return;
      
      const goals = loadGoals(openedPatientId);
      
      $("goalsList").innerHTML = goals.map(g => {
        let statusClass = "meta-andamento";
        let statusText = "â³ Em andamento";
        
        if (g.status === "concluida") {
          statusClass = "meta-concluida";
          statusText = "âœ… ConcluÃ­da";
        } else if (g.status === "cancelada") {
          statusClass = "meta-cancelada";
          statusText = "âŒ Cancelada";
        }
        
        return `
        <div class="item ${statusClass}" style="border-left:4px solid;">
          <div style="display:flex; justify-content:space-between;">
            <div>
              <b>${escapeHtml(g.description)}</b>
              <div class="muted">Prazo: ${g.deadline || "â€”"} â€¢ ${statusText}</div>
            </div>
            <div>
              <button class="small" onclick="toggleMetaStatus('${g.id}')">â†»</button>
              <button class="small danger" onclick="deleteMeta('${g.id}')">ğŸ—‘ï¸</button>
            </div>
          </div>
        </div>
      `}).join("") || "<div class='muted'>Nenhuma meta cadastrada</div>";
    }

    window.toggleMetaStatus = (id) => {
      if (!openedPatientId) return;
      const goals = loadGoals(openedPatientId);
      const idx = goals.findIndex(g => g.id === id);
      if (idx >= 0) {
        const statusOrder = { "em_andamento": "concluida", "concluida": "cancelada", "cancelada": "em_andamento" };
        goals[idx].status = statusOrder[goals[idx].status];
        saveGoals(openedPatientId, goals);
        renderMetas();
        showAlert("âœ… Status atualizado", "success");
      }
    };

    window.deleteMeta = (id) => {
      if (!openedPatientId) return;
      const goals = loadGoals(openedPatientId).filter(g => g.id !== id);
      saveGoals(openedPatientId, goals);
      renderMetas();
      showAlert("âœ… Meta removida", "success");
    };

    // ========== INICIALIZAÃ‡ÃƒO ==========
    function init() {
      $("date").value = todayISO();
      $("schedRef").value = todayISO();
      $("today").innerHTML = new Date().toLocaleDateString("pt-BR", {
        weekday: "long", year: "numeric", month: "long", day: "numeric"
      });

      // Backup
      $("backupNow").addEventListener("click", downloadBackup);
      $("restoreBackup").addEventListener("click", () => $("backupModal").classList.remove("hidden"));
      $("cancelBackup").addEventListener("click", () => $("backupModal").classList.add("hidden"));
      $("confirmRestore").addEventListener("click", () => {
        const file = $("backupFile").files[0];
        if (file) restoreFromFile(file);
        $("backupModal").classList.add("hidden");
      });

      $("autoBackupToggle").addEventListener("click", () => {
        autoBackup = !autoBackup;
        localStorage.setItem("autoBackup", autoBackup);
        $("autoBackupToggle").innerHTML = autoBackup ? "ğŸ”µ Auto: ON" : "âšª Auto: OFF";
      });

      // Tabs
      $("tabDashboard").addEventListener("click", () => setTab("dashboard"));
      $("tabDaily").addEventListener("click", () => setTab("daily"));
      $("tabPatients").addEventListener("click", () => setTab("patients"));
      $("tabSchedule").addEventListener("click", () => { setTab("schedule"); renderSchedule(); });
      $("tabReports").addEventListener("click", () => { setTab("reports"); generateReports(); });

      // AÃ§Ãµes
      $("addPatient").addEventListener("click", addPatient);
      $("addSession").addEventListener("click", addSession);
      $("findInDay").addEventListener("click", findInDay);
      $("clearDay").addEventListener("click", clearDay);
      $("resetAll").addEventListener("click", resetAll);
      $("date").addEventListener("change", renderDaily);
      $("search").addEventListener("input", renderDaily);
      $("pSearch").addEventListener("input", renderPatientFolders);
      $("backToFolders").addEventListener("click", () => {
        openedPatientId = null;
        $("folderOpenPane").classList.add("hidden");
        $("foldersPane").classList.remove("hidden");
      });
      $("schedRef").addEventListener("change", renderSchedule);
      $("addTime").addEventListener("click", addTime);
      $("resetTimes").addEventListener("click", resetTimes);
      
      // BotÃµes da pasta
      $("btnAnamnese").addEventListener("click", openAnamnese);
      $("btnEvolucao").addEventListener("click", () => {
        $("evoData").value = todayISO();
        $("evolucaoModal").classList.remove("hidden");
      });
      $("btnMetas").addEventListener("click", () => {
        $("metaModal").classList.remove("hidden");
      });
      $("openWhats").addEventListener("click", openWhatsApp);
      $("editPatient").addEventListener("click", editPatient);
      $("deletePatient").addEventListener("click", deletePatient);
      $("onlyDebtFolders").addEventListener("click", toggleDebtFilter);
      $("themeToggle").addEventListener("click", toggleTheme);

      // Modais
      $("closeAnamnese").addEventListener("click", () => $("anamneseModal").classList.add("hidden"));
      $("saveAnamnese").addEventListener("click", saveAnamnese);
      $("cancelEvo").addEventListener("click", () => $("evolucaoModal").classList.add("hidden"));
      $("saveEvo").addEventListener("click", saveEvolucao);
      $("cancelMeta").addEventListener("click", () => $("metaModal").classList.add("hidden"));
      $("saveMeta").addEventListener("click", saveMeta);

      // Filtros
      $("filterHoje").addEventListener("click", filterHoje);
      $("filterAmanha").addEventListener("click", filterAmanha);
      $("filterSemana").addEventListener("click", filterSemana);
      
      $("historyYear").addEventListener("change", (e) => {
        historyFilters.year = e.target.value;
        renderPatientHistory();
      });
      $("historyMonth").addEventListener("change", (e) => {
        historyFilters.month = e.target.value;
        renderPatientHistory();
      });
      $("clearHistoryFilter").addEventListener("click", () => {
        historyFilters = { year: "all", month: "all" };
        $("historyYear").value = "all";
        $("historyMonth").value = "all";
        renderPatientHistory();
      });

      // Abas
      $("tabHistory").addEventListener("click", () => {
        $("tabHistory").classList.add("active");
        $("tabEvolution").classList.remove("active");
        $("tabGoals").classList.remove("active");
        $("tabHistoryContent").classList.remove("hidden");
        $("tabEvolutionContent").classList.add("hidden");
        $("tabGoalsContent").classList.add("hidden");
      });

      $("tabEvolution").addEventListener("click", () => {
        $("tabHistory").classList.remove("active");
        $("tabEvolution").classList.add("active");
        $("tabGoals").classList.remove("active");
        $("tabHistoryContent").classList.add("hidden");
        $("tabEvolutionContent").classList.remove("hidden");
        $("tabGoalsContent").classList.add("hidden");
        renderEvolucoes();
      });

      $("tabGoals").addEventListener("click", () => {
        $("tabHistory").classList.remove("active");
        $("tabEvolution").classList.remove("active");
        $("tabGoals").classList.add("active");
        $("tabHistoryContent").classList.add("hidden");
        $("tabEvolutionContent").classList.add("hidden");
        $("tabGoalsContent").classList.remove("hidden");
        renderMetas();
      });

      // Atalhos
      $("shortcutsHint").addEventListener("click", () => {
        $("shortcutsPanel").classList.toggle("hidden");
      });

      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey) {
          e.preventDefault();
          if (e.key === "n") { setTab("patients"); $("cName").focus(); }
          if (e.key === "f") { setTab("daily"); $("search").focus(); }
          if (e.key === "1") setTab("dashboard");
          if (e.key === "2") setTab("daily");
          if (e.key === "3") setTab("patients");
          if (e.key === "4") { setTab("schedule"); renderSchedule(); }
          if (e.key === "5") { setTab("reports"); generateReports(); }
        }
      });

      // Carregar dados
      renderPatientSelect();
      renderDaily();
      renderPatientFolders();
      renderSchedule();
      renderDashboard();
      generateReports();
    }

    function setTab(tab) {
      $("viewDashboard").classList.toggle("hidden", tab !== "dashboard");
      $("viewDaily").classList.toggle("hidden", tab !== "daily");
      $("viewPatients").classList.toggle("hidden", tab !== "patients");
      $("viewSchedule").classList.toggle("hidden", tab !== "schedule");
      $("viewReports").classList.toggle("hidden", tab !== "reports");

      [$("tabDashboard"), $("tabDaily"), $("tabPatients"), $("tabSchedule"), $("tabReports")].forEach(t =>
        t.classList.remove("active")
      );
      $(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add("active");
    }

    // ========== AÃ‡Ã•ES DE PACIENTE ==========
    function addPatient() {
      const name = $("cName").value.trim();
      if (!name) return showAlert("âŒ Nome obrigatÃ³rio", "error");

      const patient = {
        id: uid(),
        name,
        birth: $("cBirth").value,
        cpf: $("cCpf").value,
        resp: $("cResp").value,
        phone: $("cPhone").value,
        email: $("cEmail").value,
        serviceType: $("cServiceType").value,
        defaultValue: parseMoney($("cDefaultValue").value),
        billingType: $("cBillingType").value,
        fixedDay: $("cFixDay").value,
        fixedHour: $("cFixHour").value,
        notes: $("cNotes").value,
        anamnese: { queixa: "", historico: "", obs: "" },
        createdAt: new Date().toISOString()
      };

      const patients = loadPatients();
      patients.push(patient);
      savePatients(patients);

      if (patient.fixedDay && patient.fixedHour) {
        const sch = loadSchedule();
        sch.recurring = sch.recurring || {};
        const key = recurKey(parseInt(patient.fixedDay), patient.fixedHour);

        if (!sch.recurring[key]) {
          sch.recurring[key] = {
            patientId: patient.id,
            serviceType: patient.serviceType,
            startDate: todayISO(),
            plannedTotal: patient.billingType === "pack4" ? 4 : patient.billingType === "pack8" ? 8 : 1
          };

          if (!sch.times.includes(patient.fixedHour)) {
            sch.times.push(patient.fixedHour);
            sch.times.sort();
          }
          saveSchedule(sch);
        }
      }

      // Limpar formulÃ¡rio
      $("cName").value = "";
      $("cBirth").value = "";
      $("cCpf").value = "";
      $("cResp").value = "";
      $("cPhone").value = "";
      $("cEmail").value = "";
      $("cDefaultValue").value = "";
      $("cFixHour").value = "";
      $("cNotes").value = "";

      renderPatientSelect();
      renderPatientFolders();
      renderSchedule();
      renderDashboard();
      showAlert("âœ… Paciente cadastrado!", "success");
    }

    function openAnamnese() {
      const p = getPatientById(openedPatientId);
      if (p) {
        $("aQueixa").value = p.anamnese?.queixa || "";
        $("aHistorico").value = p.anamnese?.historico || "";
        $("aObs").value = p.anamnese?.obs || "";
        $("anamneseModal").classList.remove("hidden");
      }
    }

    function saveAnamnese() {
      const patients = loadPatients();
      const idx = patients.findIndex(p => p.id === openedPatientId);
      if (idx >= 0) {
        patients[idx].anamnese = {
          queixa: $("aQueixa").value,
          historico: $("aHistorico").value,
          obs: $("aObs").value
        };
        savePatients(patients);
        $("anamneseModal").classList.add("hidden");
        showAlert("âœ… Anamnese salva!", "success");
      }
    }

    function saveEvolucao() {
      if (!openedPatientId) return;
      
      const data = $("evoData").value;
      const texto = $("evoTexto").value.trim();
      
      if (!data || !texto) {
        showAlert("âŒ Preencha todos os campos", "error");
        return;
      }
      
      const evolutions = loadEvolutions(openedPatientId);
      evolutions.push({
        id: uid(),
        date: data,
        text: texto,
        createdAt: new Date().toISOString()
      });
      
      saveEvolution(openedPatientId, evolutions);
      $("evolucaoModal").classList.add("hidden");
      $("evoTexto").value = "";
      renderEvolucoes();
      showAlert("âœ… EvoluÃ§Ã£o registrada!", "success");
    }

    function saveMeta() {
      if (!openedPatientId) return;
      
      const desc = $("metaDesc").value.trim();
      const prazo = $("metaPrazo").value;
      
      if (!desc) {
        showAlert("âŒ DescriÃ§Ã£o obrigatÃ³ria", "error");
        return;
      }
      
      const goals = loadGoals(openedPatientId);
      goals.push({
        id: uid(),
        description: desc,
        deadline: prazo,
        status: "em_andamento",
        createdAt: new Date().toISOString()
      });
      
      saveGoals(openedPatientId, goals);
      $("metaModal").classList.add("hidden");
      $("metaDesc").value = "";
      $("metaPrazo").value = "";
      renderMetas();
      showAlert("âœ… Meta cadastrada!", "success");
    }

    function openWhatsApp() {
      const p = getPatientById(openedPatientId);
      if (p?.phone) {
        window.open(`https://wa.me/55${p.phone}`, "_blank");
      } else {
        showAlert("âŒ Sem WhatsApp", "error");
      }
    }

    function editPatient() {
      const p = getPatientById(openedPatientId);
      if (p) {
        const newName = prompt("Novo nome:", p.name);
        if (newName) {
          const patients = loadPatients();
          const idx = patients.findIndex(p => p.id === openedPatientId);
          patients[idx].name = newName.trim();
          savePatients(patients);
          openPatientFolder(openedPatientId);
          renderPatientFolders();
          renderPatientSelect();
          showAlert("âœ… Nome atualizado!", "success");
        }
      }
    }

    function deletePatient() {
      if (confirm("Excluir paciente e todo seu histÃ³rico?")) {
        const patients = loadPatients().filter(p => p.id !== openedPatientId);
        const sessions = loadSessions().filter(s => s.patientId !== openedPatientId);

        const sch = loadSchedule();
        if (sch.recurring) {
          Object.keys(sch.recurring).forEach(key => {
            if (sch.recurring[key].patientId === openedPatientId) {
              delete sch.recurring[key];
            }
          });
        }

        savePatients(patients);
        saveSessions(sessions);
        saveSchedule(sch);

        $("folderOpenPane").classList.add("hidden");
        $("foldersPane").classList.remove("hidden");
        renderPatientFolders();
        renderPatientSelect();
        renderSchedule();
        renderDashboard();
        showAlert("ğŸ—‘ï¸ Paciente excluÃ­do!", "success");
      }
    }

    window.debtFilterActive = false;
    function toggleDebtFilter() {
      window.debtFilterActive = !window.debtFilterActive;
      $("onlyDebtFolders").classList.toggle("primary", window.debtFilterActive);
      renderPatientFolders();
    }

    // ========== AÃ‡Ã•ES DE SESSÃƒO ==========
    function addSession() {
      const date = $("date").value;
      const patientId = $("pPatient").value;
      const time = $("pTime").value;
      const did = $("pDid").value;
      const just = $("pJust").value;
      const paid = $("pPaid").value;
      const manualValue = $("pValue").value;

      if (!date || !patientId) return showAlert("âŒ Selecione data e paciente", "error");

      const p = getPatientById(patientId);
      let value = manualValue ? parseMoney(manualValue) : (p?.defaultValue || 0);
      if (p?.serviceType === "cassems") value = 26;

      const session = {
        id: uid(),
        date, patientId, time,
        did: did,
        just: did === "nao" ? (just === "na" ? "nao_justificada" : just) : "na",
        paid, value
      };

      const sessions = loadSessions();
      sessions.push(session);
      saveSessions(sessions);

      $("pTime").value = "";
      $("pValue").value = "";
      renderDaily();
      renderDashboard();
      if (openedPatientId) openPatientFolder(openedPatientId);
      showAlert("âœ… SessÃ£o adicionada!", "success");
    }

    function findInDay() {
      const term = $("search").value.toLowerCase();
      const patient = loadPatients().find(p => p.name.toLowerCase().includes(term));
      if (patient) {
        $("pPatient").value = patient.id;
      }
      renderDaily();
    }

    function clearDay() {
      const date = $("date").value;
      if (confirm(`Limpar todas as sessÃµes de ${date}?`)) {
        const sessions = loadSessions().filter(s => s.date !== date);
        saveSessions(sessions);
        renderDaily();
        showAlert("ğŸ—‘ï¸ Dia limpo!", "success");
      }
    }

    function resetAll() {
      if (confirm("âš ï¸ Isso apagarÃ¡ TODOS os dados!")) {
        localStorage.clear();
        location.reload();
      }
    }

    // ========== AÃ‡Ã•ES DE AGENDA ==========
    function addTime() {
      const time = $("newTime").value.trim();
      if (!time) return;
      if (!/^\d{1,2}:\d{2}$/.test(time)) {
        return showAlert("âŒ Use HH:MM", "error");
      }

      const sch = loadSchedule();
      if (!sch.times.includes(time)) {
        sch.times.push(time);
        sch.times.sort();
        saveSchedule(sch);
        renderSchedule();
        showAlert(`âœ… HorÃ¡rio ${time} adicionado!`, "success");
      }
      $("newTime").value = "";
    }

    function resetTimes() {
      if (confirm("Restaurar horÃ¡rios padrÃ£o?")) {
        const sch = loadSchedule();
        sch.times = defaultTimes();
        saveSchedule(sch);
        renderSchedule();
        showAlert("âœ… HorÃ¡rios restaurados!", "success");
      }
    }

    function filterHoje() {
      const hoje = (new Date().getDay() + 6) % 7;
      highlightDay(hoje);
    }

    function filterAmanha() {
      const amanha = (new Date().getDay() + 7) % 7;
      highlightDay(amanha);
    }

    function filterSemana() {
      document.querySelectorAll("#schedTable td").forEach(td => td.style.background = "");
    }

    function highlightDay(dayIndex) {
      document.querySelectorAll("#schedTable td").forEach(td => td.style.background = "");
      const rows = document.querySelectorAll("#schedTable tbody tr");
      rows.forEach(row => {
        const cells = row.querySelectorAll("td:not(.timeCell)");
        if (cells[dayIndex]) {
          cells[dayIndex].style.background = "rgba(14,165,233,.2)";
        }
      });
    }

    // Iniciar
    init();
  </script>
</body>

</html>
