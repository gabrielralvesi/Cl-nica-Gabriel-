<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Painel — Diagnóstico</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial;background:#0b1220;color:#e7eefc;padding:16px}
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:14px;margin:10px 0}
    code{background:rgba(0,0,0,.35);padding:2px 6px;border-radius:8px}
    button{border:0;border-radius:12px;padding:10px 12px;font-weight:700}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .ok{color:#bbf7d0}
    .bad{color:#fecaca}
    a{color:#93c5fd}
    pre{white-space:pre-wrap;word-break:break-word}
  </style>
</head>
<body>
  <h2>Painel — Diagnóstico</h2>
  <div class="card">
    <div>Status: <span id="status" class="bad">carregando…</span></div>
    <div style="margin-top:8px">Se você está vendo esta tela, o <b>GitHub Pages</b> e o <b>painel.html</b> estão abrindo normalmente no iPad.</div>
  </div>

  <div class="card">
    <div><b>Informações</b></div>
    <pre id="info"></pre>
  </div>

  <div class="card">
    <div class="row">
      <button id="btnClear">Limpar dados do sistema</button>
      <button id="btnReload">Recarregar</button>
      <button id="btnOpenReal">Abrir painel real (app)</button>
    </div>
    <div style="margin-top:10px" class="bad" id="msg"></div>
    <div style="margin-top:10px" class="row">
      <a id="directLink" href="#" target="_blank">Abrir painel.html direto</a>
      <a id="rootLink" href="./" target="_blank">Abrir página inicial (./)</a>
    </div>
  </div>

  <div class="card">
    <div><b>Erros capturados</b></div>
    <pre id="errors">(nenhum ainda)</pre>
  </div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const errors = [];
  function logErr(e){
    const text = (e && e.message) ? e.message : String(e);
    errors.push(text);
    $("errors").textContent = errors.join("\n---\n");
  }
  window.addEventListener("error", (ev)=>{
    logErr("JS error: " + (ev.message||"") + " @ " + (ev.filename||"") + ":" + (ev.lineno||"") );
  });
  window.addEventListener("unhandledrejection", (ev)=>{
    logErr("Promise: " + (ev.reason && ev.reason.message ? ev.reason.message : String(ev.reason)));
  });

  // show info
  const info = {
    href: location.href,
    origin: location.origin,
    path: location.pathname,
    userAgent: navigator.userAgent,
    time: new Date().toISOString(),
    hasLocalStorage: (function(){ try{ localStorage.setItem("__t","1"); localStorage.removeItem("__t"); return true; }catch(e){ return false; } })()
  };
  $("info").textContent = JSON.stringify(info, null, 2);

  $("directLink").href = location.origin + location.pathname.replace(/\/[^\/]*$/, "/") + "painel.html?dbg=1";
  $("btnClear").onclick = ()=>{
    try{
      localStorage.clear();
      sessionStorage.clear();
      $("msg").textContent = "Dados limpos ✅ Agora recarregue.";
    }catch(e){
      $("msg").textContent = "Não consegui limpar: " + (e.message||e);
    }
  };
  $("btnReload").onclick = ()=>location.reload();
  // This expects you to keep the real app as app.html while this file is painel.html (temporary).
  $("btnOpenReal").onclick = ()=>{
    const url = location.origin + location.pathname.replace(/\/[^\/]*$/, "/") + "app.html?x=" + Date.now();
    window.location.href = url;
  };

  $("status").textContent = "OK ✅ abriu";
  $("status").className = "ok";
})();
</script>
</body>
</html>
